<h1 class="text-xl">
    <span class="text-gray-500">App\Entity\</span><span class="underline">{{ fqcn }}</span>
    <span class="text-sm">( {{ nbItems }} items )</span>
    <button type="button" class="hover:text-blue-800 hover:border-blue-300 hover:cursor-pointer border border-transparent bg-blue-100 mb-1 px-1 rounded-2xl h-7 w-7 text-center"
        hx-get="{{ path('autoadmin_entity_update', {'fqcn': fqcn|url_encode, 'id': 'new'}) }}" 
        hx-push-url="true" hx-target="#content"><div class="-mt-1">+</div></button>
    {% if app.request.query.all|filter((v, k) => k starts with 'f_' and v is not empty)|length > 0 %}
        <span class="text-sm text-gray-500"> - filtered by 
            {{ app.request.query.all
                |filter((v, k) => k starts with 'f_' and v is not empty)
                |keys
                |map((k) => k|replace({'f_': ''}) )
                |join(', ') 
            }}
        </span>
    {% endif %}
</h1>
<div class="flex justify-between items-center pr-4 py-2">
    <span class="text-sm text-gray-600">
        Affichage {{ ((currentPage - 1) * perPage|default(25)) + 1 }} à 
        {{ min(currentPage * perPage|default(25), nbItems) }} sur {{ nbItems }} résultats
    </span>
    {% if app.request.query.all|filter((v, k) => k starts with 'f_' and v is not empty)|length > 0 %}
    <a href="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode}) }}" 
       class="text-sm text-red-600 hover:underline">
        Effacer les filtres
    </a>
    {% endif %}
</div>
{# Table with filters #}
<div class="overflow-x-auto">
    <form id="filterForm" 
        hx-get="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode}) }}"
        hx-trigger="change from:input"
        hx-target="#content" hx-swap="innerHTML" hx-push-url="true">
    <table class="table-auto m-4 ">
        <thead>
            <tr class="bg-gray-200">
                <th class="bg-white p-2 text-left"></th>
                {% for header in headers %}
                    <th class="border border-white p-1 text-left">
                        {{ header }}{% if identifier == header %} (PK){% endif %}<br/>
                        {% if header in filterables %}
                            <input type="text" 
                                class="border w-full border-gray-200 rounded px-1 py-0.5 placeholder:text-black/40 text-purple-800 not-placeholder-shown:border-purple-800"
                                placeholder="Filter"
                                value="{{ app.request.query.get('f_' ~ header)|default('') }}"
                                name="f_{{ header }}"/>
                        {% else %}
                            &nbsp;
                        {% endif %}
                    </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
                {{ item|raw }}
            {% endfor %}
        </tbody>
    </table>
    </form>
</div>
{# Pagination #}
{% if totalPages > 1 %}
    <div class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white p-2 rounded shadow-md">
        {% set filters = app.request.query|filter((v, k) => k starts with 'f_')|map((v, k) => k|url_encode ~ '=' ~ v|url_encode)|join('&') %}
        
        {# Bouton précédent #}
        <button type="button" 
            class="text-blue-800 hover:bg-gray-200 px-2 py-1 rounded {% if currentPage == 1 %}opacity-50 cursor-not-allowed{% else %}hover:cursor-pointer{% endif %}"
            {% if currentPage > 1 %}
            hx-target="#content" 
            hx-swap="innerHTML"
            hx-push-url="true"
            hx-get="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode, 'page': currentPage - 1}) }}&{{ filters|raw }}"
            {% endif %}
            >
            &laquo;
        </button>
        
        {# Première page #}
        {% if currentPage > 3 %}
            <button type="button" class="text-blue-800 hover:bg-gray-200 hover:cursor-pointer px-2 py-1 rounded"
                hx-target="#content" 
                hx-swap="innerHTML"
                hx-push-url="true"
                hx-get="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode, 'page': 1}) }}&{{ filters|raw }}">
                1
            </button>
            {% if currentPage > 4 %}
                <span class="px-1">...</span>
            {% endif %}
        {% endif %}
        
        {# Pages autour de la page courante #}
        {% for page in max(1, currentPage - 2)..min(totalPages, currentPage + 2) %}
            <button type="button" 
                class="text-blue-800 hover:bg-gray-200 hover:cursor-pointer px-2 py-1 rounded {% if page == currentPage %}font-bold bg-blue-100{% endif %}" 
                hx-target="#content" 
                hx-swap="innerHTML"
                hx-push-url="true"
                hx-get="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode, 'page': page}) }}&{{ filters|raw }}"
                >
                {{ page }}
            </button>
        {% endfor %}
        
        {# Dernière page #}
        {% if currentPage < totalPages - 2 %}
            {% if currentPage < totalPages - 3 %}
                <span class="px-1">...</span>
            {% endif %}
            <button type="button" class="text-blue-800 hover:bg-gray-200 hover:cursor-pointer px-2 py-1 rounded"
                hx-target="#content" 
                hx-swap="innerHTML"
                hx-push-url="true"
                hx-get="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode, 'page': totalPages}) }}&{{ filters|raw }}">
                {{ totalPages }}
            </button>
        {% endif %}
        
        {# Bouton suivant #}
        <button type="button" 
            class="text-blue-800 hover:bg-gray-200 px-2 py-1 rounded {% if currentPage == totalPages %}opacity-50 cursor-not-allowed{% else %}hover:cursor-pointer{% endif %}"
            {% if currentPage < totalPages %}
            hx-target="#content" 
            hx-swap="innerHTML"
            hx-push-url="true"
            hx-get="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode, 'page': currentPage + 1}) }}&{{ filters|raw }}"
            {% endif %}
            >
            &raquo;
        </button>
        
        {# Sélecteur d'éléments par page #}
        <span class="ml-4 text-sm text-gray-600">
            Items/page: 
            <select 
                class="border rounded px-1 text-sm"
                hx-target="#content" 
                hx-swap="innerHTML"
                hx-push-url="true"
                name="per_page"
                hx-get="{{ path('autoadmin_entity_list', {'fqcn': fqcn|url_encode, 'page': 1}) }}&{{ filters|raw }}">
                {% for size in [10, 25, 50, 100] %}
                    <option value="{{ size }}" {% if perPage|default(25) == size %}selected{% endif %}>{{ size }}</option>
                {% endfor %}
            </select>
        </span>
    </div>
{% endif %}